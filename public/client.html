<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Test - Giao Di·ªán Ki·ªÉm Tra Web Server</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üß™ Client Test - Ki·ªÉm Tra Server</h1>
            <p>Giao Di·ªán Web ƒê·ªÉ Test Web Server - Kh√¥ng C·∫ßn Ch·∫°y Terminal</p>
        </header>

        <div class="main-content">
            <!-- Test Configuration Panel -->
            <div class="card">
                <h2>‚öôÔ∏è C·∫•u H√¨nh Ki·ªÉm Tra</h2>

                <div class="info-box">
                    <strong>Tr·∫°ng Th√°i Server:</strong> <span class="status-indicator status-online"></span>
                    <span id="server-status">ƒêang ki·ªÉm tra...</span>
                </div>

                <div class="form-group">
                    <label>S·ªë L∆∞·ª£ng Requests</label>
                    <input type="number" id="num-requests" value="20" min="1" max="100">
                </div>

                <div class="form-group">
                    <label>S·ªë Threads ƒê·ªìng Th·ªùi</label>
                    <input type="number" id="concurrent-threads" value="5" min="1" max="20">
                </div>

                <div class="form-group">
                    <label>Timeout (Gi√¢y)</label>
                    <input type="number" id="timeout" value="10" min="1" max="60">
                </div>

                <div class="form-group">
                    <label>Th√™m ƒê∆∞·ªùng D·∫´n ƒê·ªÉ Ki·ªÉm Tra</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="path-input" placeholder="vd: /index.html" style="flex: 1;">
                        <button class="btn-add" onclick="addPath()">Th√™m</button>
                    </div>
                </div>

                <div class="path-list" id="path-list">
                    <!-- C√°c ƒë∆∞·ªùng d·∫´n s·∫Ω ƒë∆∞·ª£c th√™m ·ªü ƒë√¢y -->
                </div>

                <div class="form-group">
                    <label>Ph∆∞∆°ng Th·ª©c HTTP</label>
                    <select id="http-method">
                        <option value="GET">GET</option>
                        <option value="HEAD">HEAD</option>
                    </select>
                </div>

                <div class="btn-group">
                    <button class="btn-primary" id="start-test-btn" onclick="startTest()">
                        ‚ñ∂Ô∏è B·∫Øt ƒê·∫ßu Ki·ªÉm Tra
                    </button>
                    <button class="btn-secondary" onclick="resetTest()">
                        üîÑ ƒê·∫∑t L·∫°i
                    </button>
                </div>
            </div>

            <!-- K·∫øt Qu·∫£ T√≥m T·∫Øt -->
            <div class="card">
                <h2>üìä K·∫øt Qu·∫£ Ki·ªÉm Tra</h2>

                <div id="results-summary" class="results-empty">
                    Ch·∫°y ki·ªÉm tra ƒë·ªÉ xem k·∫øt qu·∫£...
                </div>

                <div class="progress-container" id="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%;">0%</div>
                    </div>
                    <div class="progress-text" id="progress-text">ƒêang chu·∫©n b·ªã ki·ªÉm tra...</div>
                </div>

                <div class="stats-grid" id="stats-grid" style="display: none;">
                    <div class="stat-box">
                        <div class="stat-value" id="stat-success">0</div>
                        <div class="stat-label">Th√†nh C√¥ng</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stat-failed">0</div>
                        <div class="stat-label">Th·∫•t B·∫°i</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stat-avg-time">0ms</div>
                        <div class="stat-label">Th·ªùi Gian TB</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="stat-throughput">0</div>
                        <div class="stat-label">Req/Gi√¢y</div>
                    </div>
                </div>
            </div>

            <!-- K·∫øt Qu·∫£ Chi Ti·∫øt -->
            <div class="results-panel">
                <h2>üìù K·∫øt Qu·∫£ Chi Ti·∫øt</h2>

                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('raw')">ƒê·∫ßu Ra</button>
                    <button class="tab-btn" onclick="switchTab('requests')">Requests</button>
                    <button class="tab-btn" onclick="switchTab('analysis')">Ph√¢n T√≠ch</button>
                </div>

                <div id="raw-tab" class="tab-content active">
                    <div class="results-content" id="results-output">
                        Ch·∫°y ki·ªÉm tra ƒë·ªÉ xem k·∫øt qu·∫£ chi ti·∫øt...
                    </div>
                </div>

                <div id="requests-tab" class="tab-content">
                    <div class="results-content" id="requests-output">
                        Ch·∫°y ki·ªÉm tra ƒë·ªÉ xem danh s√°ch requests...
                    </div>
                </div>

                <div id="analysis-tab" class="tab-content">
                    <div class="results-content" id="analysis-output">
                        Ch·∫°y ki·ªÉm tra ƒë·ªÉ xem ph√¢n t√≠ch chi ti·∫øt...
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 Client Test Web Server | Giao Di·ªán Ki·ªÉm Tra Theo Th·ªùi Gian Th·ª±c</p>
        </footer>
    </div>

    <script>
        // Default paths
        const defaultPaths = [
            '/',
            '/index.html',
            '/about.html',
            '/style.css',
            '/404.html'
        ];

        let testResults = [];
        let currentTest = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadDefaultPaths();
            checkServerStatus();
            setInterval(checkServerStatus, 5000);
        });

        function loadDefaultPaths() {
            const pathList = document.getElementById('path-list');
            pathList.innerHTML = '';
            defaultPaths.forEach((path, idx) => {
                addPathUI(path, idx);
            });
        }

        function addPathUI(path, id) {
            const pathList = document.getElementById('path-list');
            const pathItem = document.createElement('div');
            pathItem.className = 'path-item';
            pathItem.innerHTML = `
                <span>${path}</span>
                <span class="path-remove" onclick="removePath(this)">√ó</span>
            `;
            pathList.appendChild(pathItem);
        }

        function addPath() {
            const input = document.getElementById('path-input');
            const path = input.value.trim();
            
            if (!path) {
                alert('Vui l√≤ng nh·∫≠p ƒë∆∞·ªùng d·∫´n');
                return;
            }
            
            if (!path.startsWith('/')) {
                alert('ƒê∆∞·ªùng d·∫´n ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng /');
                return;
            }
            
            addPathUI(path, Date.now());
            input.value = '';
        }

        function removePath(element) {
            element.closest('.path-item').remove();
        }

        function getPaths() {
            const paths = [];
            document.querySelectorAll('.path-item span:first-child').forEach(item => {
                paths.push(item.textContent);
            });
            return paths;
        }

        function checkServerStatus() {
            const statusEl = document.getElementById('server-status');
            const statusIndicator = document.querySelector('.status-indicator');
            
            fetch('/', { method: 'HEAD' })
                .then(res => {
                    statusEl.textContent = 'Tr·ª±c Tuy·∫øn';
                    statusIndicator.className = 'status-indicator status-online';
                })
                .catch(err => {
                    statusEl.textContent = 'Ngo·∫°i Tuy·∫øn';
                    statusIndicator.className = 'status-indicator status-offline';
                });
        }

        async function startTest() {
            const numRequests = parseInt(document.getElementById('num-requests').value);
            const method = document.getElementById('http-method').value;
            const timeout = parseInt(document.getElementById('timeout').value);
            const paths = getPaths();

            if (paths.length === 0) {
                alert('Vui l√≤ng th√™m √≠t nh·∫•t m·ªôt ƒë∆∞·ªùng d·∫´n');
                return;
            }

            if (numRequests < 1) {
                alert('S·ªë requests ph·∫£i >= 1');
                return;
            }

            testResults = [];
            const btn = document.getElementById('start-test-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ ƒêang Ki·ªÉm Tra...';

            const progressContainer = document.getElementById('progress-container');
            progressContainer.style.display = 'block';

            document.getElementById('results-output').innerHTML = '';
            document.getElementById('requests-output').innerHTML = '';
            document.getElementById('analysis-output').innerHTML = '';

            const startTime = Date.now();
            let completed = 0;

            for (let i = 0; i < numRequests; i++) {
                const path = paths[i % paths.length];
                const reqStart = Date.now();

                try {
                    const response = await fetch(path, {
                        method: method,
                        signal: AbortSignal.timeout(timeout * 1000)
                    });

                    const reqTime = Date.now() - reqStart;

                    testResults.push({
                        id: i + 1,
                        path: path,
                        method: method,
                        status: response.status,
                        time: reqTime,
                        success: response.ok,
                        contentLength: response.headers.get('content-length') || 'kh√¥ng x√°c ƒë·ªãnh'
                    });

                    appendToOutput(`‚úì [${i + 1}/${numRequests}] ${method} ${path} - Tr·∫°ng Th√°i: ${response.status} - Th·ªùi Gian: ${reqTime}ms\n`);

                } catch (error) {
                    const reqTime = Date.now() - reqStart;

                    testResults.push({
                        id: i + 1,
                        path: path,
                        method: method,
                        status: 'L·ªñI',
                        time: reqTime,
                        success: false,
                        error: error.message
                    });

                    appendToOutput(`‚úó [${i + 1}/${numRequests}] ${method} ${path} - L·ªói: ${error.message}\n`);
                }

                completed++;
                updateProgress(completed, numRequests);
            }

            const totalTime = Date.now() - startTime;
            displayResults(totalTime);

            btn.disabled = false;
            btn.textContent = '‚ñ∂Ô∏è B·∫Øt ƒê·∫ßu Ki·ªÉm Tra';
        }

        function updateProgress(completed, total) {
            const percent = Math.round((completed / total) * 100);
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = percent + '%';
            progressFill.textContent = percent + '%';
            document.getElementById('progress-text').textContent = `ƒê√£ Ho√†n Th√†nh: ${completed}/${total} requests`;
        }

        function appendToOutput(text) {
            const output = document.getElementById('results-output');
            output.textContent += text;
            output.scrollTop = output.scrollHeight;
        }

        function displayResults(totalTime) {
            const successful = testResults.filter(r => r.success).length;
            const failed = testResults.filter(r => !r.success).length;
            const avgTime = testResults.reduce((sum, r) => sum + r.time, 0) / testResults.length;
            const throughput = (testResults.length / (totalTime / 1000)).toFixed(2);

            // Update stats
            document.getElementById('stat-success').textContent = successful;
            document.getElementById('stat-failed').textContent = failed;
            document.getElementById('stat-avg-time').textContent = avgTime.toFixed(2) + 'ms';
            document.getElementById('stat-throughput').textContent = throughput;

            document.getElementById('stats-grid').style.display = 'grid';

            // Update summary
            const summary = `
‚úÖ Ki·ªÉm Tra Ho√†n Th√†nh!

T·ªïng Requests: ${testResults.length}
Th√†nh C√¥ng: ${successful}
Th·∫•t B·∫°i: ${failed}
T·ª∑ L·ªá Th√†nh C√¥ng: ${((successful / testResults.length) * 100).toFixed(1)}%

Hi·ªáu Su·∫•t:
  Th·ªùi Gian Trung B√¨nh: ${avgTime.toFixed(2)}ms
  Th·ªùi Gian T·ªëi Thi·ªÉu: ${Math.min(...testResults.map(r => r.time))}ms
  Th·ªùi Gian T·ªëi ƒêa: ${Math.max(...testResults.map(r => r.time))}ms
  Th√¥ng L∆∞·ª£ng: ${throughput} req/gi√¢y
  T·ªïng Th·ªùi Gian: ${(totalTime / 1000).toFixed(2)}s
            `;

            document.getElementById('results-summary').textContent = summary;
            document.getElementById('results-summary').className = '';

            // Request details
            let requestsOutput = 'ID | ƒê∆∞·ªùng D·∫´n | Ph∆∞∆°ng Th·ª©c | Tr·∫°ng Th√°i | Th·ªùi Gian (ms)\n';
            requestsOutput += '---|----------|-------------|-----------|----------------\n';
            testResults.forEach(r => {
                const status = r.status || 'L·ªñI';
                requestsOutput += `${r.id} | ${r.path} | ${r.method} | ${status} | ${r.time}\n`;
            });
            document.getElementById('requests-output').textContent = requestsOutput;

            // Analysis
            const statusCodes = {};
            testResults.forEach(r => {
                const code = r.status || 'L·ªñI';
                statusCodes[code] = (statusCodes[code] || 0) + 1;
            });

            let analysisOutput = 'Ph√¢n B·ªë M√£ Tr·∫°ng Th√°i:\n';
            analysisOutput += '-------------------\n';
            Object.entries(statusCodes).forEach(([code, count]) => {
                const percent = ((count / testResults.length) * 100).toFixed(1);
                analysisOutput += `${code}: ${count} (${percent}%)\n`;
            });

            document.getElementById('analysis-output').textContent = analysisOutput;
        }

        function switchTab(tabName) {
            // ·∫®n t·∫•t c·∫£ tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Hi·ªÉn th·ªã selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        function resetTest() {
            testResults = [];
            document.getElementById('results-output').textContent = 'Ch·∫°y ki·ªÉm tra ƒë·ªÉ xem k·∫øt qu·∫£...';
            document.getElementById('requests-output').textContent = 'Ch·∫°y ki·ªÉm tra ƒë·ªÉ xem requests...';
            document.getElementById('analysis-output').textContent = 'Ch·∫°y ki·ªÉm tra ƒë·ªÉ xem ph√¢n t√≠ch...';
            document.getElementById('results-summary').textContent = 'Ch·∫°y ki·ªÉm tra ƒë·ªÉ xem k·∫øt qu·∫£...';
            document.getElementById('progress-container').style.display = 'none';
            document.getElementById('stats-grid').style.display = 'none';
        }
    </script>
</body>
</html>
